## Milvus `query` 和 `search` 这两个操作的区别
                                            
### 作者                                           
digoal                                          
                                         
### 日期                                        
2025-10-28                                        
                                          
### 标签                                          
Milvus , query , search , 向量相似搜索 , 标量精准过滤                                             
                                          
----                                          
                                          
## 背景    
Milvus 中 `query` 和 `search` 这两个操作的区别是什么?    
  
## 核心区别

**Search(搜索)** 是基于向量相似度的查询操作, 用于找到与给定向量最相似的结果。 它需要提供查询向量, 并返回 topK 个最相似的结果。 

**Query(查询)** 是基于标量过滤条件的查询操作, 用于根据表达式检索满足条件的所有数据。它不需要向量输入, 而是使用过滤表达式(如 `id < 100`)来检索数据。 

## 实现层面的差异

在内部实现中,这两个操作由不同的方法处理:

- **Search** 通过 `SearchSegments` 方法执行向量搜索, 使用向量索引(如 HNSW、IVF)进行相似度计算 

- **Query** 通过 `QuerySegments` 方法执行标量查询, 基于过滤条件检索数据  

## API 使用示例

**Search 示例:**
```python
res = client.search(
    collection_name="demo_collection",
    data=query_vectors,  # 查询向量
    limit=2,  # 返回 top-2 结果
    output_fields=["vector", "text"]
)
``` 

**Query 示例:**
```python
res = client.query(
    collection_name="quick_setup",
    filter="emb_type == 3",  # 过滤条件
    output_fields=["id", "emb_type"]
)
```  

## Notes
两个操作在测试代码中经常一起使用, 先用 `search` 进行向量相似度搜索, 再用 `query` 进行精确的标量过滤。 它们都支持输出字段选择、分区过滤等功能, 但核心检索机制不同: search 基于向量相似度, query 基于标量条件。 
  
    
#### [期望 PostgreSQL|开源PolarDB 增加什么功能?](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216")
  
  
#### [PolarDB 开源数据库](https://openpolardb.com/home "57258f76c37864c6e6d23383d05714ea")
  
  
#### [PolarDB 学习图谱](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL 解决方案集合](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's Github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
