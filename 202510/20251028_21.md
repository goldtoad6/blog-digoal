## CUDA architecture 在 Milvus 中的作用以及如何使用  
                                              
### 作者                                             
digoal                                            
                                           
### 日期                                          
2025-10-28                                          
                                            
### 标签                                            
Milvus , query , search , 向量相似搜索 , 标量精准过滤                                               
                                            
----                                            
                                            
## 背景      
CUDA architecture 在 Milvus 中主要用于 **GPU 加速的向量索引构建和搜索**。 当启用 GPU 版本时, Milvus 可以利用 NVIDIA GPU 来加速向量计算操作。    
  
具体来说, CUDA architecture 参数用于指定编译时针对哪些 GPU 架构进行优化, 这直接影响生成的 CUDA 代码的性能和兼容性。   
  
## 如何使用  
  
### 1. 编译时配置  
  
在构建 Milvus 时,可以通过 `-s` 参数指定 CUDA architecture:    
  
```bash  
./scripts/core_build.sh -g -s "DEFAULT"  
# 或指定特定架构  
./scripts/core_build.sh -g -s "-gencode=compute_61,code=sm_61;-gencode=compute_75,code=sm_75"  
```  
  
这个参数会被传递给 CMake 配置:   
  
### 2. Makefile 构建  
  
使用 Makefile 构建 GPU 版本:    
  
```bash  
make build-cpp-gpu  
```  
  
### 3. CMake 配置  
  
在 CMake 层面, GPU 版本通过 `MILVUS_GPU_VERSION` 和 `MILVUS_CUDA_ARCH` 变量控制:    
  
当启用 GPU 版本时,项目会包含 CUDA 语言支持:    
  
### 4. 运行时配置  
  
在部署时, 需要配置 GPU 资源和 CUDA 设备:    
  
GPU 内存信息可以通过 CUDA Runtime API 获取:    
  
### 5. Docker 环境  
  
使用 GPU 构建环境时,需要使用专门的 GPU builder 镜像:    
  
## Notes  
  
- 默认的 CUDA_ARCH 值是 "DEFAULT",这会让编译器自动选择合适的架构。    
- GPU 版本的构建需要安装 CUDA toolkit,默认路径为 `/usr/local/cuda`。    
- GPU 功能主要用于 `queryNode` 和 `indexNode` 组件,用于加速向量搜索和索引构建。    
- Milvus 支持 GPU 内存池管理,可以配置初始内存大小和最大内存大小。   
    
#### [期望 PostgreSQL|开源PolarDB 增加什么功能?](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216")
  
  
#### [PolarDB 开源数据库](https://openpolardb.com/home "57258f76c37864c6e6d23383d05714ea")
  
  
#### [PolarDB 学习图谱](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL 解决方案集合](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's Github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
